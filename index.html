<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title></title>
	</head>
	<body>
		<button type="button" id="submit">Send</button>
<script>
const toDataURL = (src, callback, outputFormat) => {
	const img = new Image();
	img.crossOrigin = 'Anonymous';
	img.onload = function() {
		const canvas = document.createElement('canvas');
		const ctx = canvas.getContext('2d');
		let dataURL;
		canvas.height = this.naturalHeight;
		canvas.width = this.naturalWidth;
		ctx.drawImage(this, 0, 0);
		dataURL = canvas.toDataURL(outputFormat);
		callback(dataURL);
	};
	img.src = src;
};

const submit = document.querySelector('#submit');
submit.addEventListener('click', e => {
	toDataURL('test.png', dataUrl => {
		const data = new FormData();
		data.append('disaster', 'Polar');
		data.append('image', dataUrl);
		fetch('https://thunderapi.thinkingboxserver.ca/api/1/download', {
			method: 'POST',
			body: data,
		})
			.then(response => response.blob())
			.then(blob => {
				const url = window.URL.createObjectURL(blob);
				const a = document.createElement('a');
				a.href = url;
				a.download = 'Geostorm.mp4';
				a.click();
			})
			.catch(err => {
				console.log(err);
			});
	});
});
</script>
	</body>
</html>
